# Nginx Configuration for Tajawaz Solutions PWA
# Include this in your main nginx.conf or site config

# Service Worker - No Cache
location = /sw.js {
    add_header Cache-Control "no-cache, no-store, must-revalidate";
    add_header Pragma "no-cache";
    add_header Expires "0";
    add_header Service-Worker-Allowed "/";
    types { application/javascript js; }
}

# Manifest - Short Cache (1 week)
location ~* \.webmanifest$ {
    add_header Cache-Control "public, max-age=604800";
    types { application/manifest+json webmanifest; }
}

location = /assets/pwa/manifest.json {
    add_header Cache-Control "public, max-age=604800";
    types { application/manifest+json json; }
}

# HTML - Short Cache (1 hour)
location ~* \.html$ {
    add_header Cache-Control "public, max-age=3600";
    types { text/html html; }
}

# CSS & JavaScript - 1 year
location ~* \.(css|js)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Images - 1 year
location ~* \.(jpg|jpeg|png|gif|ico|svg|webp)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Fonts - 1 year
location ~* \.(woff|woff2|ttf|eot)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
    add_header Access-Control-Allow-Origin "*";
}

# Media - 1 year
location ~* \.(mp4|webm|ogg|mp3|wav)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Security Headers
add_header X-Content-Type-Options "nosniff" always;
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-XSS-Protection "1; mode=block" always;
add_header Referrer-Policy "strict-origin-when-cross-origin" always;
add_header Permissions-Policy "geolocation=(), microphone=(), camera=()" always;

# Gzip Compression
gzip on;
gzip_vary on;
gzip_proxied any;
gzip_comp_level 6;
gzip_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/rss+xml
    application/atom+xml
    image/svg+xml
    application/manifest+json;

# Brotli Compression (if available)
brotli on;
brotli_comp_level 6;
brotli_types
    text/plain
    text/css
    text/xml
    text/javascript
    application/json
    application/javascript
    application/xml+rss
    application/manifest+json;
