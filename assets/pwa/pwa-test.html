<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PWA Test - Tajawaz Solutions</title>

    <!-- Global Styles -->
    <link rel="stylesheet" href="/assets/css/style.css" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/assets/pwa/manifest.json" />
    <meta name="theme-color" content="#5f2ded" />
    <style>
      body {
        font-family: var(--global-font);
        background: var(--secondary);
        min-height: 100vh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 20px;
        color: var(--primary);
      }

      .container {
        background: radial-gradient(
          at top left,
          var(--accent-color-3) 0%,
          var(--accent-color-4) 50%
        );
        backdrop-filter: blur(10px);
        border-radius: var(--global-border-radius);
        border: 1px solid var(--accent-color-3);
        padding: 40px;
        max-width: 800px;
        width: 100%;
        box-shadow: var(--box-shadow-top-left);
        transition: all 0.6s;
      }

      .container:hover {
        box-shadow: var(--box-shadow-bottom-right);
      }

      h1 {
        font-size: var(--font-size-13xl);
        margin-bottom: 10px;
        text-align: center;
        font-weight: var(--font-weight-bold);
        background: linear-gradient(284deg, var(--accent-transparent) 3%, var(--primary) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .subtitle {
        text-align: center;
        color: var(--text-color);
        margin-bottom: 40px;
        font-size: var(--font-size-lg);
        line-height: var(--line-height-relaxed);
      }

      .test-section {
        background: radial-gradient(
          at bottom right,
          var(--accent-color-3) 0%,
          var(--accent-color-4) 50%
        );
        border-radius: var(--global-border-radius);
        padding: 25px;
        margin-bottom: 20px;
        border: 1px solid var(--accent-color-3);
        box-shadow: var(--box-shadow-top-left);
        transition: all 0.3s;
      }

      .test-section:hover {
        box-shadow: var(--box-shadow-bottom-right);
      }

      .test-section h3 {
        margin-bottom: 15px;
        color: var(--primary);
        font-size: var(--font-size-3xl);
        font-weight: var(--font-weight-bold);
      }

      .test-item {
        display: flex;
        align-items: center;
        padding: 12px 0;
        border-bottom: 1px solid var(--accent-color-3);
      }

      .test-item:last-child {
        border-bottom: none;
      }

      .test-label {
        flex: 1;
        font-size: var(--font-size-base);
        color: var(--primary);
        font-weight: var(--font-weight-medium);
      }

      .test-status {
        padding: 6px 15px;
        border-radius: 100px;
        font-weight: var(--font-weight-semibold);
        font-size: var(--font-size-sm);
      }

      .status-success {
        background: #10b981;
        color: white;
      }

      .status-error {
        background: #ef4444;
        color: white;
      }

      .status-pending {
        background: #f59e0b;
        color: white;
      }

      .btn {
        display: inline-block;
        padding: 20px 30px;
        background: var(--accent-color);
        color: var(--accent-color-2);
        border: none;
        border-radius: 100px;
        font-weight: var(--font-weight-semibold);
        cursor: pointer;
        margin: 5px;
        text-decoration: none;
        transition: all 0.3s;
        font-size: var(--font-size-base);
        box-shadow: var(--box-shadow-top-left);
        font-family: var(--global-font);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: var(--box-shadow-bottom-right);
      }

      .btn-group {
        text-align: center;
        margin-top: 30px;
      }

      .info-box {
        background: radial-gradient(
          at center center,
          var(--accent-color-6) 0%,
          var(--accent-transparent) 70%
        );
        border-left: 4px solid var(--accent-color);
        padding: 15px 20px;
        border-radius: var(--global-border-radius);
        border: 1px solid var(--accent-color-3);
        margin-top: 20px;
      }

      .info-box p {
        margin: 5px 0;
        font-size: var(--font-size-base);
        color: var(--text-color);
        line-height: var(--line-height-relaxed);
      }

      .info-box strong {
        color: var(--accent-color);
      }

      @media (max-width: 600px) {
        .container {
          padding: 25px;
        }

        h1 {
          font-size: var(--font-size-11xl);
        }

        .test-item {
          flex-direction: column;
          align-items: flex-start;
        }

        .test-status {
          margin-top: 8px;
        }
      }
    </style>
  </head>
  <body class="keep-dark">
    <div class="container">
      <h1>üß™ PWA Test Dashboard</h1>
      <p class="subtitle">Tajawaz Solutions - Progressive Web App Validation</p>

      <div class="test-section">
        <h3>üìã Service Worker Status</h3>
        <div class="test-item">
          <span class="test-label">Service Worker Support</span>
          <span class="test-status" id="sw-support">Checking...</span>
        </div>
        <div class="test-item">
          <span class="test-label">Service Worker Registered</span>
          <span class="test-status" id="sw-registered">Checking...</span>
        </div>
        <div class="test-item">
          <span class="test-label">Service Worker Active</span>
          <span class="test-status" id="sw-active">Checking...</span>
        </div>
      </div>

      <div class="test-section">
        <h3>üì¶ Manifest & Icons</h3>
        <div class="test-item">
          <span class="test-label">Manifest Linked</span>
          <span class="test-status" id="manifest-link">Checking...</span>
        </div>
        <div class="test-item">
          <span class="test-label">PWA Manager Loaded</span>
          <span class="test-status" id="pwa-manager">Checking...</span>
        </div>
        <div class="test-item">
          <span class="test-label">Theme Color Set</span>
          <span class="test-status" id="theme-color">Checking...</span>
        </div>
      </div>

      <div class="test-section">
        <h3>üíæ Installation Status</h3>
        <div class="test-item">
          <span class="test-label">PWA Installable</span>
          <span class="test-status" id="installable">Checking...</span>
        </div>
        <div class="test-item">
          <span class="test-label">Current Display Mode</span>
          <span class="test-status" id="display-mode">Checking...</span>
        </div>
      </div>

      <div class="info-box">
        <strong>‚ÑπÔ∏è Informasi:</strong>
        <p id="info-text">Menjalankan test PWA...</p>
      </div>

      <div class="btn-group">
        <a href="index.html" class="btn">‚Üê Kembali ke Home</a>
        <button onclick="location.reload()" class="btn">Refresh Test</button>
      </div>
    </div>

    <!-- PWA Manager -->
    <script defer src="/assets/pwa/pwa-manager.js"></script>

    <script>
      // Helper function to update status
      function setStatus(id, status, text) {
        const el = document.getElementById(id);
        el.textContent = text;
        el.className = 'test-status status-' + status;
      }

      // Test 1: Service Worker Support
      if ('serviceWorker' in navigator) {
        setStatus('sw-support', 'success', '‚úÖ Supported');

        // Test 2: Service Worker Registration
        navigator.serviceWorker.getRegistration().then((registration) => {
          if (registration) {
            setStatus('sw-registered', 'success', '‚úÖ Registered');

            // Test 3: Service Worker Active
            if (registration.active) {
              setStatus('sw-active', 'success', '‚úÖ Active');
            } else if (registration.installing) {
              setStatus('sw-active', 'pending', '‚è≥ Installing...');
            } else {
              setStatus('sw-active', 'error', '‚ùå Not Active');
            }
          } else {
            setStatus('sw-registered', 'error', '‚ùå Not Registered');
            setStatus('sw-active', 'error', '‚ùå Not Active');

            // Try to register
            navigator.serviceWorker
              .register('/sw.js')
              .then(() => {
                setStatus('sw-registered', 'success', '‚úÖ Registered');
                setTimeout(() => location.reload(), 1000);
              })
              .catch(() => {
                setStatus('sw-registered', 'error', '‚ùå Registration Failed');
              });
          }
        });
      } else {
        setStatus('sw-support', 'error', '‚ùå Not Supported');
        setStatus('sw-registered', 'error', '‚ùå N/A');
        setStatus('sw-active', 'error', '‚ùå N/A');
      }

      // Test 4: Manifest
      const manifestLink = document.querySelector('link[rel="manifest"]');
      if (manifestLink) {
        setStatus('manifest-link', 'success', '‚úÖ Found');

        // Fetch and validate manifest
        fetch(manifestLink.href)
          .then((res) => res.json())
          .then((manifest) => {
            console.log('Manifest loaded:', manifest);
          })
          .catch(() => {
            setStatus('manifest-link', 'error', '‚ö†Ô∏è Invalid');
          });
      } else {
        setStatus('manifest-link', 'error', '‚ùå Not Found');
      }

      // Test 5: PWA Manager
      if (window.PWAManager || window.pwaManager) {
        setStatus('pwa-manager', 'success', '‚úÖ Loaded');
      } else {
        // Wait a bit for deferred script
        setTimeout(() => {
          if (window.PWAManager || window.pwaManager) {
            setStatus('pwa-manager', 'success', '‚úÖ Loaded');
          } else {
            setStatus('pwa-manager', 'error', '‚ùå Not Loaded');
          }
        }, 1000);
      }

      // Test 6: Theme Color
      const themeColor = document.querySelector('meta[name="theme-color"]');
      if (themeColor) {
        setStatus('theme-color', 'success', `‚úÖ ${themeColor.content}`);
      } else {
        setStatus('theme-color', 'error', '‚ùå Not Set');
      }

      // Test 7: Installability
      let deferredPrompt;
      window.addEventListener('beforeinstallprompt', (e) => {
        deferredPrompt = e;
        setStatus('installable', 'success', '‚úÖ Yes');
      });

      // Check if already installed
      if (window.matchMedia('(display-mode: standalone)').matches) {
        setStatus('installable', 'success', '‚úÖ Already Installed');
        setStatus('display-mode', 'success', 'üéâ Standalone');
      } else {
        setTimeout(() => {
          if (!deferredPrompt) {
            setStatus('installable', 'pending', '‚è≥ Waiting...');
          }
        }, 2000);
        setStatus('display-mode', 'pending', 'üåê Browser');
      }

      // Update info text
      setTimeout(() => {
        const allSuccess = document.querySelectorAll('.status-success').length;
        const allTests = document.querySelectorAll('.test-status').length;
        const percentage = Math.round((allSuccess / allTests) * 100);

        document.getElementById('info-text').innerHTML = `
                Test selesai: <strong>${allSuccess}/${allTests}</strong> passed (${percentage}%)<br>
                ${
                  percentage === 100
                    ? 'üéâ PWA siap digunakan!'
                    : '‚ö†Ô∏è Ada beberapa issue yang perlu diperbaiki'
                }
            `;
      }, 3000);
    </script>
  </body>
</html>
